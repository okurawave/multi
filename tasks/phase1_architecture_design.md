# タスクID: phase1_architecture_design

## タイトル
システムアーキテクチャ設計

## 目的
ParallelXec-Agentの全体構成・技術選定・各モジュールの役割を明確化する。

## 実装内容

### 1. コアエンジン(Orchestrator)
- 全体の制御・タスク管理を担う中心モジュール。
- 各サブモジュールへの指示・進捗管理・エラー処理を統括。

### 2. プロジェクト管理(Git Repository)
- プロジェクトのバージョン管理・履歴管理をGitで実施。
- Git MCPツールを用いてブランチ運用・Pull Request・マージ等を自動化。

### 3. 作業環境(Git Worktree)
- 複数作業ブランチを同時に展開可能なワークツリー構成。
- 各タスクごとに独立した作業ディレクトリを生成し、並行作業を実現。

### 4. 実行環境(tmux Session)
- タスクごとに独立したtmuxセッションを割り当て、並列実行・監視を可能にする。
- セッション管理・ログ取得・自動再起動等をOrchestratorから制御。

### 5. 技術要素の選定理由と連携方法
- **Python**: 全体の制御・各モジュール連携のための主要言語。豊富なライブラリと柔軟な記述性。
- **libtmux**: tmuxセッションの操作・管理をPythonから行うためのライブラリ。セッション生成・コマンド投入・ログ取得等をAPI経由で実現。
- **watchdog**: ファイルシステムの変更監視。Git Worktreeや成果物ディレクトリの自動検知・イベント駆動処理に利用。
- **subprocess**: 外部コマンド実行・プロセス管理。Git操作や各種CLIツールの呼び出しに使用。
- **Git**: プロジェクトの履歴管理・ブランチ運用・Pull Request等の基盤。Git MCPツールと連携し、APIベースで操作。

#### 連携方法
- Orchestratorが各モジュールをPython経由で制御。
- libtmuxでセッション管理、watchdogでファイル監視、subprocessで外部コマンド実行。
- Git MCPツールをAPI経由で呼び出し、ブランチ・PR・マージ等を自動化。

### 6. モジュール間の責務分担と連携フロー
- Orchestratorが全体の進行管理・エラー処理を担当。
- Git Repository管理はGit MCPツール経由で実施。
- Git Worktreeは各タスクごとにディレクトリを分離し、watchdogで変更監視。
- tmux Sessionはlibtmuxで生成・管理し、各タスクの実行環境を分離。
- 各モジュールはAPI/CLI経由で連携し、進捗・状態をOrchestratorに報告。

## 前提条件
- フェーズ0の成果物(要件定義・タスクリスト)が存在すること。

## 完了条件
- アーキテクチャ設計が明文化され、各モジュールの役割が明確になっていること。

## 参考
- [`docs/about.md`](docs/about.md:1) 「システムアーキテクチャ」
- [`docs/how2.md`](docs/how2.md:1) 「ディレクトリ構造」「主要コンポーネント」